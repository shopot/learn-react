---
sidebar_position: 21
---

# Работа с асинхронными данными

В современных веб-приложениях часто приходится работать с данными, которые загружаются асинхронно, например, через API. 
В этой статье мы рассмотрим, как обрабатывать асинхронные данные в React, используя `useState` и `useEffect`, а также как имитировать задержку загрузки для более реалистичного поведения.

## Постановка задачи

В нашем приложении есть два основных взаимодействия:

- Поиск по списку — изменяемый фильтр, зависящий от состояния `searchTerm`.
- Удаление элементов — необратимое действие через обработчик `handleRemoveStory`, удаляющее элемент из списка.

Иногда данные не доступны сразу при рендеринге компонента, а должны быть загружены асинхронно (например, с сервера). Давайте смоделируем такую ситуацию.

## Имитация асинхронной загрузки данных

**1. Создание функции-заглушки**

Для начала создадим функцию `getAsyncStories`, которая возвращает `Promise` с данными.
В упрощённой версии она сразу возвращает `Promise.resolve`

```ts
const getAsyncStories = (): Promise<{ data: { stories: Story[] } }> => 
  Promise.resolve({ data: { stories: initialStories } });
```

**2. Загрузка данных при монтировании компонента**

Вместо использования `initialStories` в начальном состоянии, мы начнём с пустого массива и загрузим данные асинхронно:

```tsx
function App() {
  const [searchTerm, setSearchTerm] = usePersistedSearch('search', '');
  const [stories, setStories] = useState<Story[]>([]);

  useEffect(() => {
    getAsyncStories().then((result) => {
      setStories(result.data.stories);
    });
  }, []); // Эффект выполняется только при первом рендере
  
// ... остальной код
}
```
Пока что данные загружаются мгновенно, что не похоже на реальный API-запрос.

**3. Добавление искусственной задержки**

Чтобы сделать загрузку более реалистичной, модифицируем `getAsyncStories`, добавив задержку в 2 секунды:

```ts
const getAsyncStories = (): Promise<{ data: { stories: Story[] } }> =>
  new Promise((resolve) =>
    setTimeout(() => resolve({ data: { stories: initialStories } }), 2000),
  );
```

Теперь при запуске приложения:

- Сначала отобразится пустой список (`stories = []`).
- Через 2 секунды данные загрузятся, и список обновится.

## Заключение

Работа с асинхронными данными — неотъемлемая часть разработки на React. В этой статье мы разобрали, как:

- Загружать данные асинхронно, используя `Promise` и `useEffect`.
- Имитировать задержку ответа API для реалистичного поведения.
- Обновлять состояние после получения данных.

В реальных приложениях реализация `getAsyncStories` будет построена с использованием  `fetch` или библиотеки типа `axios` для запросов к API.
